
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.

    Created on : 28-mar-2018, 20:57:14
    Author     : pamaco
-->

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Cartime - Mapa</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
        <script src="http://ahalota.github.io/Leaflet.CountrySelect/Leaflet.CountrySelect.js"></script>
        <style>
            .scrollableitems
            {
                max-height: 650px;
                overflow-y: scroll;
                overflow-x: hidden;
            }
            ul.item
            {
                list-style-type: none;
                margin-left:0px;
                padding-left:0px;
            }
            ul.item li
            {
                float: left;
            }
            ul.item li:hover
            {
                background-color:#000;
                opacity:0.7;
            }
        </style>
    </head>
    <body>
        <div class="container" style="width:100%; padding:0; margin:0 auto;">
            <nav class="navbar navbar-light bg-light navbar-static-top"  style="border: 0; padding:0; margin:0; width:100%;background:black;">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar" style="margin-right:0">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="index.html" style="padding:0; margin:0;">
                            <img class="img-responsive" src="Imagenes/logocartime.jpg" alt="logo" style="height: 50px; margin:0;padding:0">
                        </a>
                    </div>
                    <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="index.html">Inicio</a></li>
                        <li><a href="publicar_plaza.html">Publicar plaza</a></li>
                        <li ><a href="mapa.html">Parkings</a></li>
                
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Acceder <span class="glyphicon glyphicon-user"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="login.html">Iniciar sesi√≥n</a></li>
                            <li><a href="registro.html">Registrarse</a></li>
                        </ul>
                        </li>
                    </ul>
                    </div>
                </div>
            </nav>
            <div class="container" style="width:90%; padding:0; margin:0 auto;">
            <div class="row" style="margin:0;padding:0">
                <div class="container col-sm-6" style="margin:0;padding:0">
                    <h2 style="margin:1em;margin-left:0">Buscar parkings</h2>
                    <div style="width:100%; height: 50px; padding:0; margin:0; background: #E6E6E6"> 
                        <form style="width:100%;margin-right:0" class="navbar-form navbar-left collapse navbar-collapse" id="mySearcher" action="#">
                            <div class="form-group">
                                <input type="text" class="form-control" id="myText" placeholder="Buscar parkings">
                            </div>
                            <button style="align:right" type="submit" class="btn btn-default"><span class="glyphicon glyphicon-search"></span></button>
                        </form>
                    </div>	
                    <div id="map" style="width: 100%;height:600px;position:static;padding:0;"></div>
                </div>
                <div class="container col-sm-6" style="margin:0;">
                    <h2 style="margin:1em;margin-left:1.6em;height: 25px;">Plazas disponibles</h2>
                    <div class="container scrollableitems" style="width:100%;margin:0;padding:3em;padding-top:0;">
                        <ul class="item">
                            <li style="width:200px; height:160px;margin-top:0.5em;margin-right:2em;margin-bottom:2em;">
                                <a href="plaza.html">
                                    <h5 style="background: #E6E6E6;padding:4%; margin:0">Parking 1</h5>
                                    <img class="img-responsive" src="Imagenes/plazas/parking1.jpg" alt="parking1">
                                </a>
                            </li>
                            <li style="width:200px; height:160px;margin-top:0.5em;margin-right:2em;margin-bottom:2em;">
                                <a href="plaza.html">
                                    <h5 style="background: #E6E6E6;padding:4%; margin:0">Parking 2</h5>
                                    <img class="img-responsive" src="Imagenes/plazas/parking2.jpg" alt="parking2">
                                </a>
                            </li>
                            <li style="width:200px; height:160px;margin-top:0.5em;margin-right:2em;margin-bottom:2em;">
                                <a href="plaza.html">
                                    <h5 style="background: #E6E6E6;padding:4%; margin:0">Parking 3</h5>
                                    <img class="img-responsive" src="Imagenes/plazas/parking3.jpg" alt="parking3">
                                </a>
                            </li>
                            <li style="width:200px; height:160px;margin-top:0.5em;margin-right:2em;margin-bottom:2em;">
                                <a href="plaza.html">
                                    <h5 style="background: #E6E6E6;padding:4%; margin:0">Parking 4</h5>
                                    <img class="img-responsive" src="Imagenes/plazas/parking4.jpg" alt="parking4">
                                </a>
                            </li>
                            <li style="width:200px; height:160px;margin-top:0.5em;margin-right:2em;margin-bottom:2em;">
                                <a href="plaza.html">
                                    <h5 style="background: #E6E6E6;padding:4%; margin:0">Parking 5</h5>
                                    <img class="img-responsive" src="Imagenes/plazas/parking5.jpg" alt="parking5">
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>
            <div id="address"></div>
            <hr>
            <footer>
                <p>Desarrollado por el equipo Cartime. Todos los derechos reservados. <span class="glyphicon glyphicon-copyright-mark"></span></p>
            </footer>
            </div>
        </div>

        <script>
            var osmLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>',
                    thunLink = '<a href="http://thunderforest.com/">Thunderforest</a>';

            var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                    osmAttrib = '&copy; ' + osmLink + ' Contributors',
                    landUrl = 'http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png',
                    thunAttrib = '&copy; '+osmLink+' Contributors & '+thunLink;

            var osmMap = L.tileLayer(osmUrl, {attribution: osmAttrib}),
                    landMap = L.tileLayer(landUrl, {attribution: thunAttrib});

            var map = L.map('map', {
                            layers: [osmMap]
                    }).setView([25, 25], 1);

            var select = L.countrySelect({exclude:""});
        </script>

        <script>
            var json;

            var HttpClient = function() 
            {
                this.get = function(aUrl, aCallback) 
                {
                    var anHttpRequest = new XMLHttpRequest();
                    anHttpRequest.onreadystatechange = function() 
                    { 
                        if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                            aCallback(anHttpRequest.responseText);
                    }
                    anHttpRequest.open("GET", aUrl, true);            
                    anHttpRequest.send( null );
                }
            }

            $(function() 
            {
                $('#mySearcher').on('submit', function(e) 
                {
                    e.preventDefault();
                    var data = $("#myText").val();
                    var client = new HttpClient();
                    client.get('https://nominatim.openstreetmap.org/search.php?q=' + data + '&polygon=1&addressdetails=1&format=json', function(response) 
                    {
                        json = JSON.parse(response);
                        var div = document.getElementById('address');
                        div.innerHTML = '';

                        if(Object.keys(json).length == 0)
                                alert("No se pudo geolocalizar la direccion");

                        else if(Object.keys(json).length == 1)
                                map.setView([json[0].lat, json[0].lon], 20);
                        else
                        {	
                            map.setView([json[0].lat, json[0].lon], 20);

                            for(a = 0; a < Object.keys(json).length; a++)
                            {
                                div.innerHTML += JSON.stringify(json[a].address) + '<br>';
                            }
                        }
                    });
                });
            });
        </script>
    </body>
</html>